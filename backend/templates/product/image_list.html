{% extends 'base.html' %}
{% load static %}
{% block content %}
<section id="main-content">
  <section class="wrapper main-wrapper">

    <!-- Page Title -->
    <div class="col-xl-12">
      <div class="page-title">
        <div class="float-left"></div>
      </div>
    </div>

    <div class="clearfix"></div>

    <!-- Product Images Section -->
    <div class="col-xl-12">
      <section class="box shadow-sm rounded-3 border-0 bg-white">

        <!-- Top Right Buttons -->
        <div class="d-flex align-items-center no-print float-right" style="gap: 8px;">
          <a href="{% url 'admin_dashboard' %}"
             class="btn btn-light border shadow-sm"
             data-bs-toggle="tooltip" data-bs-placement="bottom" title="Home">
            <i class="fa-solid fa-house text-primary" style="font-size: 14px;"></i>
          </a>

          <button onclick="window.print()" 
                  class="btn btn-light border shadow-sm"
                  data-bs-toggle="tooltip" data-bs-placement="bottom" title="Print Page">
            <i class="fa-solid fa-print text-dark" style="font-size: 14px;"></i>
          </button>

          <a href="?q={{ search_query }}&material={{ selected_material }}&role={{ selected_role }}&export=pdf"
             class="btn btn-light border shadow-sm"
             data-bs-toggle="tooltip" data-bs-placement="bottom" title="Export as PDF">
            <i class="fa-solid fa-file-pdf text-danger" style="font-size: 14px;"></i>
          </a>

          <a href="?q={{ search_query }}&material={{ selected_material }}&role={{ selected_role }}&export=excel"
             class="btn btn-light border shadow-sm"
             data-bs-toggle="tooltip" data-bs-placement="bottom" title="Export as Excel">
            <i class="fa-solid fa-file-excel text-success" style="font-size: 14px;"></i>
          </a>
        </div>

        <div class="clearfix"></div>
        <div class="text-center">
          <h4 class="fw-bold text-dark mb-0" style="letter-spacing: 1px;">Panda Print</h4>
        </div>

        <header class="panel_header border-bottom mb-3 align-items-center justify-content-between px-4 bg-light rounded-top">
          <div class="align-items-left">
            <div class=" align-items-left>
                        <h2 class="title fw-semibold text-secondary mb-0" style="text-transform: capitalize; font-weight: bolder;">Product Image Table</h2>
                    </div>
          </div>
        </header>

        <div class="content-body p-4 bg-white border border-light rounded-bottom">

          <!-- Search Form -->
          <div class="row mb-3 align-items-center">
            <div class="col-md-12 d-flex align-items-center" style="gap: 10px;">
              <form method="get" class="d-flex align-items-center" style="gap: 10px;">
                <div class="input-group" style="max-width: 300px;">
                  <input type="text" name="q" class="form-control border-end-0"
                         placeholder="Search Image..." value="{{ search_query }}">
                  <button type="submit" class="btn btn-primary" style="border-radius: 0 8px 8px 0;"
                          data-bs-toggle="tooltip" title="Search">
                    <i class="fa-solid fa-magnifying-glass"></i>
                  </button>
                </div>

                

                

                <a href="{% url 'add_image' %}" 
                   class="btn shadow-sm d-flex align-items-center"
                   style="background-color: #17a2b8; color: white; padding: 0.5rem 1.25rem; border-radius: 8px; border: none; gap: 6px; font-weight: 500;"
                   data-bs-toggle="tooltip" title="Add New Image">
                  <i class="fa-solid fa-plus" style="font-size: 14px;"></i>
                  <span>Add New</span>
                </a>

                {% if search_query or selected_material or selected_role %}
                <a href="{% url 'image_list' %}"
                   class="btn btn-outline-secondary px-3 rounded"
                   data-bs-toggle="tooltip" title="Clear Search">
                  Clear
                </a>
                {% endif %}
              </form>
            </div>
          </div>

          <!-- Table -->
          <div class="table-responsive mt-2">
            <table class="table table-striped table-bordered align-middle text-center">
              <thead class="table-light">
                <tr>
                  <th><strong>Preview</strong></th>
                  <th><strong>Material</strong></th>
                  <th><strong>Role</strong></th>
                  <th><strong>Caption</strong></th>
                  <th><strong>Display Order</strong></th>
                  <th><strong>Actions</strong></th>
                </tr>
              </thead>
              <tbody>
                {% for img in images %}
                <tr>
                  <td>
                    {% if img.image_file %}
                    <img src="{{ img.image_file.url }}" alt="{{ img.caption }}"
                         style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px;">
                    {% else %}
                    <span class="text-muted">No Image</span>
                    {% endif %}
                  </td>
                  <td>{{ img.material.name }}</td>
                  <td>{{ img.role }}</td>
                  <td>{{ img.caption }}</td>
                  <td>{{ img.display_order }}</td>
                  <td>
                    <a href="{% url 'edit_image' img.id %}"
                       class="btn btn-outline-primary btn-sm me-1 rounded shadow-sm"
                       data-bs-toggle="tooltip" title="Edit Image">
                      <i class="fa-solid fa-pen"></i>
                    </a>
                    <a href="{% url 'delete_image' img.id %}"
                       class="btn btn-outline-danger btn-sm rounded shadow-sm"
                       data-bs-toggle="tooltip" title="Delete Image"
                       onclick="return confirm('Are you sure you want to delete this image?');">
                      <i class="fa-solid fa-trash"></i>
                    </a>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="6" class="text-center text-muted">No product images found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <nav aria-label="Page navigation">
            <ul class="pagination pagination-sm justify-content-center align-items-center">
              {% if images.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page=1&q={{ search_query }}&material={{ selected_material }}&role={{ selected_role }}" title="First Page">
                  <i class="fa fa-angle-double-left"></i>
                </a>
              </li>
              {% endif %}

              <li class="page-item {% if not images.has_previous %}disabled{% endif %}">
                <a class="page-link"
                   {% if images.has_previous %}
                   href="?page={{ images.previous_page_number }}&q={{ search_query }}&material={{ selected_material }}&role={{ selected_role }}"
                   {% endif %}>
                  <i class="fa fa-chevron-left"></i>
                </a>
              </li>

              <li class="page-item active">
                <span class="page-link">{{ images.number }} / {{ images.paginator.num_pages }}</span>
              </li>

              <li class="page-item {% if not images.has_next %}disabled{% endif %}">
                <a class="page-link"
                   {% if images.has_next %}
                   href="?page={{ images.next_page_number }}&q={{ search_query }}&material={{ selected_material }}&role={{ selected_role }}"
                   {% endif %}>
                  <i class="fa fa-chevron-right"></i>
                </a>
              </li>

              {% if images.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ images.paginator.num_pages }}&q={{ search_query }}&material={{ selected_material }}&role={{ selected_role }}">
                  <i class="fa fa-angle-double-right"></i>
                </a>
              </li>
              {% endif %}
            </ul>
          </nav>
        </div>
      </section>
    </div>
  </section>
</section>

<!-- âœ… Styling -->
<style>
  .box {
    border: 1px solid #e1e1e1;
    background-color: #fff;
  }
  .panel_header {
    background-color: #f9f9f9;
    border-radius: 8px 8px 0 0;
  }
  .btn-light:hover {
    background-color: #f0f0f0;
    transform: translateY(-1px);
    transition: all 0.2s ease;
  }
  .btn[style*="background-color: #17a2b8"]:hover {
    background-color: #138496 !important;
  }
  .pagination .page-item.active .page-link {
    background-color: #1fb5ac;
    border-color: #1fb5ac;
    color: white;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(function(tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });
</script>

{% include 'page_header.html' %}
{% endblock %}